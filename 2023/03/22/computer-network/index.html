
<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8" />
        <title>计网常用知识总结 | IceOfSummerの博客</title>
        <meta name="author" content="IceOfSummer" />
        <meta name="description" content="后面一辈子的博客都在这了！" />
        <meta name="keywords" content="" />
        <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />
        <script src="https://selfb.asia/static/lib/vue-3.2.47.global.prod.min.js"></script>
<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/6.3.0/css/all.min.css" />
<link rel="stylesheet" href="https://selfb.asia/static/particlex/static/fonts.min.css" />
<script>
  const mixins = {};
  const h = (arg1, arg2, arg3) => {
    if (arg2.attrs) {
      Object.assign(arg2, arg2.attrs)
      Reflect.deleteProperty(arg2, 'attrs')
    }
    if (arg2.on) {
      Object.keys(arg2.on).forEach(key => {
        const head = key.charAt(0).toUpperCase()
        arg2['on' + head  + key.substring(1)] = arg2.on[key]
      })
      Reflect.deleteProperty(arg2, 'on')
    }
    return Vue.h(arg1, arg2, arg3)
  }
</script>

<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>


<script src="https://selfb.asia/static/lib/highlight-11.7.0.min.js"></script>
<link
    rel="stylesheet"
    href="https://cdn.staticfile.org/highlight.js/11.7.0/styles/github.min.css"
/>
<script src="/js/lib/highlight.js"></script>



<script src="/js/lib/preview.js"></script>









<link rel="stylesheet" href="/css/main.css" />

  <script src="/js/lib/toc.js"></script>



  <script src="/js/lib/lazy-load-support.js"></script>


    <meta name="generator" content="Hexo 7.3.0"></head>
    <body>
        <div id="layout">
            <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>加载过慢请开启缓存&ensp;浏览器默认开启</p>
                    <img src="/images/loading.gif" />
                </div>
            </div>
            </transition>
            <transition name="into">
            <div id="main" v-show="!loading">
                <nav id="menu" ref="menu">
    <div class="desktop-menu">
        <a class="title" href="/">
            <span>ICEOFSUMMERの博客</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
    </div>
    <div id="mobile-menu">
        <div class="curtain" v-show="showMenu" @click="showMenu = !showMenu"></div>
        <div class="title" @click="showMenu = !showMenu">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;ICEOFSUMMERの博客</span>
        </div>
        <transition name="slide">
        <div class="items" v-show="showMenu">
            
            <a href="/">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-house fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                </div>
            </a>
            
            <a href="/about">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-id-card fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                </div>
            </a>
            
            <a href="/archives">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-box-archive fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                </div>
            </a>
            
            <a href="/categories">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-bookmark fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                </div>
            </a>
            
            <a href="/tags">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-tags fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                </div>
            </a>
            
        </div>
        </transition>
    </div>
</nav>

                <div class="article">
    <div>
        <h1>计网常用知识总结</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2023/3/22
        </span>
        
        
    </div>
    
    <toc-component></toc-component>
    <div class="content" v-pre id="main-content">
        <h1 id="1-网际协议IP"><a href="#1-网际协议IP" class="headerlink" title="1. 网际协议IP"></a>1. 网际协议IP</h1><h2 id="1-1-IPv4"><a href="#1-1-IPv4" class="headerlink" title="1.1 IPv4"></a>1.1 IPv4</h2><p><img lazy="https://selfb.asia/public/post/2023-2-4-7b4a02b9-5e93-4d3e-80e8-ec67eda52d2a.webp" alt="IP报文格式"></p>
<ul>
<li>版本：IPv4为4，IPv6即为6</li>
<li>首部长度：<font color=red>单位为4字节</font>，因此头部最长为15个4字节，即60字节</li>
<li>区分服务（旧版叫服务类型）：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/160937314">QoS分类和标记 - 知乎 (zhihu.com)</a></li>
<li>总长度：总长度包括首部和数据的长度。</li>
<li>标识：用于路由器分片重组。同一个分片的标志值相同，不同的分片的标识值不同。</li>
<li>标志：占3位，但只两位可以使用<ul>
<li>最低位(可以理解为最右边)：记为MF(More Fragment)。MF &#x3D; 1标识后面<strong>还有分片</strong>。</li>
<li>中间位：记为DF(Don’t Fragment)，意为<strong>不能分片</strong>，只有当DF &#x3D; 0时才允许分片。</li>
</ul>
</li>
<li>片偏移：较长的分组在分片后，某片在原分组中的相对位置，单位是8字节。<ul>
<li>例如有一个数据有3800字节，被分为了1400字节、1400字节、1000字节(忽略了首部)，则它们的片偏移分别为：<code>0/8 = 0</code>，<code>1400 / 8 = 175</code>，<code>2800 / 8 = 350</code></li>
</ul>
</li>
<li>生存时间：一般称为TTL(Time To Live)，标明数据报在网络中的<strong>寿命</strong>。最初的设计是以<font color=red>秒</font>作为TTL的单位，每经过一个路由器就减掉响应的时间，到零时则会被丢弃。然而随着技术的进步，路由器处理数据报所需的时间不断在缩短，一般都远远小于1秒，后来就把TTL字段的功能改为“跳数限制”，即每经过一个路由器，就将该值减一，到零时就删除掉，最大值为255</li>
<li>协议：见下表</li>
</ul>
<table>
<thead>
<tr>
<th>协议名</th>
<th align="center">ICMP</th>
<th align="center">IGMP</th>
<th align="center">IP</th>
<th align="center">TCP</th>
<th align="center">EGP</th>
<th align="center">IGP</th>
<th align="center">UDP</th>
<th align="center">IPv6</th>
<th align="center">ESP</th>
<th align="center">ICMP-IPv6</th>
</tr>
</thead>
<tbody><tr>
<td>字段值</td>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">4</td>
<td align="center"><font color=red>6</font></td>
<td align="center">8</td>
<td align="center">9</td>
<td align="center"><font color=red>17</font></td>
<td align="center">41</td>
<td align="center">50</td>
<td align="center">58</td>
</tr>
</tbody></table>
<ul>
<li>首部校验和：这个字段只检验数据报的首部，但不包括数据部分。具体运算方式是把首部按16字节划分，然后按照反码算术相加得到。</li>
<li>源地址：发送IP数据报主机的IP地址</li>
<li>目的地址：占32位。接收IP数据报主机的IP地址</li>
<li>选项：由于选项很难背用到，而且也会增加路由器的开销，因此在IPv6中，IP数据报首部长度被改为固定值了</li>
</ul>
<h2 id="1-2-IPv6"><a href="#1-2-IPv6" class="headerlink" title="1.2 IPv6"></a>1.2 IPv6</h2><p><img lazy="https://selfb.asia/public/post/2023-2-4-48265f3c-796f-4a2e-a261-b4f4ed0cd38f.webp" alt="IPv6"></p>
<ul>
<li><p>版本：IPv6肯定就是6了</p>
</li>
<li><p>通信量类(Traffic Class)：这是为了区分不同的IPv6数据报的类别或优先级，和IPv4的区分服务字段的作用相似。</p>
</li>
<li><p>流标号(Flow Label)：IPv6的一个新的机制是支持资源预分配，并且允许路由器把每个数据报与一个给定的资源分配相联系。</p>
</li>
<li><p>有效荷载长度：它指明IPv6数据报除基本首部以为的字节数（所有扩展首部都算在有效荷载之内）。</p>
</li>
<li><p>下一个首部：它相当于IPv4的协议字段或可选字段。</p>
</li>
<li><p>跳数限制：用来防止数据报在网络中无期限的存在。</p>
</li>
</ul>
<h1 id="2-TCP"><a href="#2-TCP" class="headerlink" title="2. TCP"></a>2. TCP</h1><h2 id="2-1-三次握手"><a href="#2-1-三次握手" class="headerlink" title="2.1 三次握手"></a>2.1 三次握手</h2><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/430799766">深入浅出TCP三次握手 （多图详解） - 知乎 (zhihu.com)</a></p>
<p>主要是要记住客户端和服务端的状态：</p>
<ul>
<li>客户端：CLOSED -&gt; SYN-SENT -&gt; ESTABLISHED</li>
<li>服务端：CLOSED -&gt; SYN-RCVD -&gt; ESTABLISHED</li>
</ul>
<p>之后在每次通信时，下次消息的<code>seq</code>为对方上次消息的<code>ack</code>，下次消息的<code>ack</code>为对方上次消息的<code>seq + 总数据长度</code>(同一个<code>seq</code>可能会有多个消息)</p>
<p><font color=red>在握手时，虽然数据长度为0，在理解时需要将其”当做”长度为1。</font></p>
<h2 id="2-2-四次挥手"><a href="#2-2-四次挥手" class="headerlink" title="2.2 四次挥手"></a>2.2 四次挥手</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/LOOKTOMMER/article/details/121307137">TCP四次挥手详解_‍oOoOoOooOO的博客-CSDN博客</a></p>
<p>客户端和服务端的状态：</p>
<ul>
<li>客户端(主动关闭的那一方)：ESTABLISHED -&gt; FIN_WAIT -&gt; TIME_WAIT(等待2ms) -&gt; CLOSE</li>
<li>服务端(响应关闭的那一方)：ESTABLISHED -&gt; CLOSE_WAIT -&gt; LAST_ACK -&gt; CLOSE</li>
</ul>
<p>这里在主动关闭的那一方需要等待2MSL，原因如下：</p>
<ul>
<li><p>首先占用该端口，因为IP报文在网络中的生存时间是有限的，让旧的报文全部在网络中被丢弃</p>
</li>
<li><p>若主动关闭的那一方的ACK没有被服务端收到，此时服务端再次返回一个FIN报文，会被客户端错误的以为是一个错误报文而导致状态重置(发送RST报文)</p>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/99943313">TCP的TIME_WAIT状态 - 知乎 (zhihu.com)</a></p>
<h2 id="2-3-TCP报文格式"><a href="#2-3-TCP报文格式" class="headerlink" title="2.3 TCP报文格式"></a>2.3 TCP报文格式</h2><p><a target="_blank" rel="noopener" href="http://c.biancheng.net/view/6441.html">TCP报文格式解析 (biancheng.net)</a></p>
<p>其中可能比较难记的就是8个标志位的前两个了，其实只需要记住全称就不容易忘了：</p>
<ul>
<li>CWR：Congestion Window Reduce</li>
<li>ECE：ECN Echo，全称Explicit Congestin Notification Echo</li>
</ul>
<p>里面还有个校验和，这里需要知道是怎么算的。在计算机网络第八版P218中介绍了UDP的检验和计算：</p>
<ul>
<li>首先在数据报前添加一个伪首部</li>
<li>将校验和的位置置零</li>
<li>以16位2个字节为单位，如果由于数据的长度导致无法满足该条件，则在数据部分后补零即可。之后将所有数据相加，如果溢出，则添加到低位(二进制反码运算求和)</li>
<li>将结果取反添加到校验和的位置</li>
</ul>
<p>在验证时同样使用上面的方法，但不用把校验位置零，若计算结果最终为全1，则表示数据无误</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42560250/article/details/113526217">TCP&#x2F;UDP伪头部详解_tcp 伪头部_M、k的博客-CSDN博客</a></p>
<p>需要注意的是IP报文的校验不包含数据。</p>
<h1 id="3-路由器和交换机"><a href="#3-路由器和交换机" class="headerlink" title="3. 路由器和交换机"></a>3. 路由器和交换机</h1><p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/jiPMUk6zUdOY6eKxAjNDbQ">如果让你来设计网络 (qq.com)</a></p>
<p>交换机是工作在数据链路层的，它根据每台设备的MAC地址来转发数据。</p>
<p>而路由器是工作在网络层的，它负责IP报文的转发。</p>

    </div>
    
    
    
    
    <div id="comment">
        <div id="giscus-container" class="giscus"></div>
    </div>
    
    
    
    
</div>

                <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2022 - 2024 IceOfSummerの博客
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;<a target="_blank" rel="noopener" href="https://github.com/IceOfSummer">IceOfSummer</a>
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/IceOfSummer/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

            </div>
            </transition>
            
            <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
            </transition>
            
        </div>
        <script src="/js/main.js"></script>
        
        
<script
    src="https://giscus.app/client.js"
    data-repo="IceOfSummer/iceofsummer.github.io"
    data-repo-id="R_kgDOJFU7OQ"
    data-category="Announcements"
    data-category-id="DIC_kwDOJFU7Oc4CUyC7"
    data-mapping="title"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="top"
    data-theme="preferred_color_scheme"
    data-lang="zh-CN"
    crossorigin
    async
></script>





        
    </body>
</html>
