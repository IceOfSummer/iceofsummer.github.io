
<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8" />
        <title>IceOfSummerの博客</title>
        <meta name="author" content="IceOfSummer" />
        <meta name="description" content="用来用去还是自己搭的博客靠谱" />
        <meta name="keywords" content="" />
        <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />
        <script src="https://cdn.staticfile.org/vue/3.2.47/vue.global.prod.min.js"></script>
<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/6.3.0/css/all.min.css" />
<link rel="stylesheet" href="https://selfb.asia/static/particlex/static/fonts.min.css" />
<script>
  const mixins = {};
  const h = (arg1, arg2, arg3) => {
    if (arg2.attrs) {
      Object.assign(arg2, arg2.attrs)
      Reflect.deleteProperty(arg2, 'attrs')
    }
    if (arg2.on) {
      Object.keys(arg2.on).forEach(key => {
        const head = key.charAt(0).toUpperCase()
        arg2['on' + head  + key.substring(1)] = arg2.on[key]
      })
      Reflect.deleteProperty(arg2, 'on')
    }
    return Vue.h(arg1, arg2, arg3)
  }
</script>

<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>


<script src="https://cdn.staticfile.org/highlight.js/11.7.0/highlight.min.js"></script>
<link
    rel="stylesheet"
    href="https://cdn.staticfile.org/highlight.js/11.7.0/styles/github.min.css"
/>
<script src="/js/lib/highlight.js"></script>



<script src="/js/lib/preview.js"></script>





<script src="/js/lib/home.js"></script>

<link rel="stylesheet" href="/css/main.css" />

  <script src="/js/lib/toc.js"></script>



  <script src="/js/lib/lazy-load-support.js"></script>


    <meta name="generator" content="Hexo 7.1.1"></head>
    <body>
        <div id="layout">
            <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>加载过慢请开启缓存&ensp;浏览器默认开启</p>
                    <img src="/images/loading.gif" />
                </div>
            </div>
            </transition>
            <transition name="into">
            <div id="main" v-show="!loading">
                <nav id="menu" ref="menu">
    <div class="desktop-menu">
        <a class="title" href="/">
            <span>ICEOFSUMMERの博客</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
    </div>
    <div id="mobile-menu">
        <div class="curtain" v-show="showMenu" @click="showMenu = !showMenu"></div>
        <div class="title" @click="showMenu = !showMenu">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;ICEOFSUMMERの博客</span>
        </div>
        <transition name="slide">
        <div class="items" v-show="showMenu">
            
            <a href="/">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-house fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                </div>
            </a>
            
            <a href="/about">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-id-card fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                </div>
            </a>
            
            <a href="/archives">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-box-archive fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                </div>
            </a>
            
            <a href="/categories">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-bookmark fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                </div>
            </a>
            
            <a href="/tags">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-tags fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                </div>
            </a>
            
        </div>
        </transition>
    </div>
</nav>

                <div id="home-head">
    <div id="home-background" ref="homeBackground" data-image="https://selfb.asia/public/2023-2-6-8d14e464-2200-4e54-af81-0d9f25f55b3e.webp,https://selfb.asia/public/2023-2-0-017e03b0-992c-4844-b28f-869799d32b96.webp,https://selfb.asia/public/2023-2-0-66a241f4-eca3-45f3-b590-05aeed688f60.webp,https://selfb.asia/public/2023-2-0-481f472f-e980-4cee-8ab8-ca66f5fd370a.webp,https://selfb.asia/public/2023-2-2-2adf4d48-496a-49a4-8ca3-f64e035d8835.webp"></div>
    
    <div id="home-info" @click="homeClick">
        <span class="loop"></span>
        <span class="loop"></span>
        <span class="loop"></span>
        <span class="loop"></span>
        <span class="info">
            <div class="wrap">
                <h1>IceOfSummerの博客</h1>
                <h3>一时起兴搭建的博客</h3>
                <h5>用来用去还是自己搭的博客靠谱</h5>
            </div>
        </span>
    </div>
    
</div>
<div id="home-posts-wrap"  ref="homePostsWrap">
    <div id="home-posts">
        <div id="posts">
            

<div class="post post-partial-show">
    <a href="/2023/09/04/arthas/">
        <h2 class="post-title">Arthas诊断线上问题</h2>
    </a>
    <div class="category-and-date">
        
        <span class="category">
            <a href="/categories/%E7%BA%BF%E4%B8%8A%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                线上问题排查
            </a>
        </span>
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2023/9/4
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <h1 id="0-Links"><a href="#0-Links" class="headerlink" title="0. Links"></a>0. Links</h1><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/alibaba/arthas/issues/71">ognl特殊用法</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/alibaba/arthas/issues/482">获取SpringContext</a></li>
</ul>
<h1 id="1-安装arthas"><a href="#1-安装arthas" class="headerlink" title="1. 安装arthas"></a>1. 安装arthas</h1><p>如果没有用docker，直接从官网下载然后丢服务器就行了，如果用的是docker那么就麻烦一点，这里我整了一个脚本来一键安装&#x2F;启动：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">workdir=<span class="string">&quot;/opt/arthas-dev&quot;</span></span><br><span class="line">user=user</span><br><span class="line">container=<span class="variable">$1</span></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="variable">$container</span> ];<span class="keyword">then</span></span><br><span class="line">	<span class="built_in">echo</span> -e <span class="string">&quot;\e[32m用法: arthas-launcher.sh [容器名|容器ID] [用户名(可选，必须和启动应用的用户一致)]\e[0m&quot;</span></span><br><span class="line">	<span class="built_in">exit</span> 0</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ ! -z <span class="variable">$2</span> ];<span class="keyword">then</span></span><br><span class="line">	user=<span class="variable">$2</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">installArthas</span></span>() &#123;</span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&quot;开始安装arthas...&quot;</span></span><br><span class="line">	docker <span class="built_in">exec</span> -u <span class="variable">$user</span> <span class="variable">$container</span> <span class="built_in">mkdir</span> <span class="variable">$workdir</span>/arthas</span><br><span class="line">	docker <span class="built_in">cp</span> jdk-8u381-linux-x64.tar.gz <span class="variable">$container</span>:<span class="variable">$workdir</span>/jdk.tar.gz</span><br><span class="line">	docker <span class="built_in">cp</span> arthas-packaging-3.7.1-bin.zip <span class="variable">$container</span>:<span class="variable">$workdir</span>/arthas/arthas.zip</span><br><span class="line">	docker <span class="built_in">exec</span> -u root <span class="variable">$container</span> <span class="built_in">chmod</span> 777 <span class="variable">$workdir</span>/jdk.tar.gz</span><br><span class="line">	docker <span class="built_in">exec</span> -u root <span class="variable">$container</span> <span class="built_in">chmod</span> 777 <span class="variable">$workdir</span>/arthas/arthas.zip</span><br><span class="line">	docker <span class="built_in">exec</span> -u <span class="variable">$user</span> <span class="variable">$container</span> tar zxvf <span class="variable">$workdir</span>/jdk.tar.gz -C <span class="variable">$workdir</span></span><br><span class="line">	docker <span class="built_in">exec</span> -u <span class="variable">$user</span> <span class="variable">$container</span> unzip <span class="variable">$workdir</span>/arthas/arthas.zip -d <span class="variable">$workdir</span>/arthas</span><br><span class="line">	docker <span class="built_in">exec</span> -u <span class="variable">$user</span> <span class="variable">$container</span> <span class="built_in">touch</span> <span class="variable">$workdir</span>/installedMark</span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&quot;安装成功!&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># --------------main--------------</span></span><br><span class="line">docker <span class="built_in">exec</span> -u <span class="variable">$user</span> <span class="variable">$container</span> <span class="built_in">test</span> -d <span class="variable">$workdir</span></span><br><span class="line"><span class="keyword">if</span> [ ! $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">	docker <span class="built_in">exec</span> -u root <span class="variable">$container</span> <span class="built_in">mkdir</span> <span class="variable">$workdir</span></span><br><span class="line">	docker <span class="built_in">exec</span> -u root <span class="variable">$container</span> <span class="built_in">chown</span> <span class="variable">$user</span> <span class="variable">$workdir</span></span><br><span class="line">	installArthas</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">docker <span class="built_in">exec</span> -u <span class="variable">$user</span> <span class="variable">$container</span> <span class="built_in">test</span> -e <span class="variable">$workdir</span>/installedMark</span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">	docker <span class="built_in">exec</span> -it -u <span class="variable">$user</span> <span class="variable">$container</span> <span class="variable">$workdir</span>/jdk1.8.0_381/bin/java -jar <span class="variable">$workdir</span>/arthas/arthas-boot.jar</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&quot;文件完整性校验失败! 重新尝试安装arthas.&quot;</span></span><br><span class="line">	installArthas</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<h1 id="2-watch"><a href="#2-watch" class="headerlink" title="2. watch"></a>2. watch</h1><h2 id="2-1-基本使用"><a href="#2-1-基本使用" class="headerlink" title="2.1 基本使用"></a>2.1 基本使用</h2><p>例如有一个Encoder的encrypt方法我们想要观察，但是由于每次请求这个方法都会被调用很多次，如果不加限制，每次会爆出很多不相干的信息。</p>
<p>watch提供了一个condition-express选项来帮助我们过滤输出：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch xxx.Encoder encrypt &#123;returnObj&#125; <span class="string">&#x27;params[0]==&quot;P@ssw0rd&quot;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>上面这条指令则是让arthas在第一个参数是<code>P@ssw0rd</code>的时候输出调用的返回值</p>
<h2 id="2-2-观察异常抛出"><a href="#2-2-观察异常抛出" class="headerlink" title="2.2 观察异常抛出"></a>2.2 观察异常抛出</h2><p>有些时候，代码抛出了异常，但是又被另外一个异常包了一层抛出去了，例如<code>throw new RuntimeException(e)</code>，甚至有的时候<br>没有被抛出：<code>log.error(e.getMessage())</code>，导致我们不能看到我们想要的调用栈。</p>
<p>而watch也提供了观察异常抛出的功能。假如有一个Encoder的encrypt方法抛出了一个ExceptionA，但是没有打印栈信息，我们可以用<br>如下指令：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch xxx.Encoder encrypt &#123;throwExp&#125; -e -x 2</span><br></pre></td></tr></table></figure>

<p><code>-e</code>表示抛出异常才触发。<br><code>-x</code>表示输出属性的遍历深度，这个是啥意思呢，例如-x的值为1的时候，watch输出的结果可能就只是对象的toString，而-x的值为2的时候，watch也会输出这个对象里面属性的toString，如果等于3，则是对象里面的属性的属性的toString…</p>
<hr>
<p>随缘更新。。</p>

            
        </div>
    </div>
    <div class="post-tags">
        
        
    </div>
    <a href="/2023/09/04/arthas/" class="go-post">阅读全文</a>
</div>

<div class="post post-partial-show">
    <a href="/2023/09/04/docker-launch/">
        <h2 class="post-title">Docker常用启动参数</h2>
    </a>
    <div class="category-and-date">
        
        <span class="category">
            <a href="/categories/Docker/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                Docker
            </a>
        </span>
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2023/9/4
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <p>不定时更新…</p>
<h1 id="达梦8"><a href="#达梦8" class="headerlink" title="达梦8"></a>达梦8</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 5236:5236 --restart=always --name dm8_01 --privileged=true -e PAGE_SIZE=16 -e LD_LIBRARY_PATH=/opt/dmdbms/bin -e INSTANCE_NAME=dm8_01 -v /data/dm8_01:/opt/dmdbms/data dm8_single:v8.1.2.128_ent_x86_64_ctm_pack4</span><br></pre></td></tr></table></figure>

<h1 id="人大金仓"><a href="#人大金仓" class="headerlink" title="人大金仓"></a>人大金仓</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -it --privileged=true -p 54321:54321 -v /opt/docker/kingbase-latest/opt/:/opt --name kingbase-latest godmeowicesun/kingbase:latest</span><br></pre></td></tr></table></figure>

<ul>
<li><p>端口: 54321</p>
</li>
<li><p>用户名: SYSTEM</p>
</li>
<li><p>密码: 123456</p>
</li>
<li><p>默认数据库: TEST</p>
</li>
</ul>
<h1 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name mysql -p 3307:3306 -e MYSQL_ROOT_PASSWORD=123456 --privileged -v /home/vagrant/mysql5.7/data:/var/lib/mysql -d mysql:5.7.42</span><br></pre></td></tr></table></figure>

<h1 id="opengauss5-0-0"><a href="#opengauss5-0-0" class="headerlink" title="opengauss5.0.0"></a>opengauss5.0.0</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --hostname=fcdea04e2440 --env=GS_PASSWORD=P@ssw0rd --env=PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin --env=EXEC_GOSU=gosu-amd64 --env=GOSU_VERSION=1.12 --env=PGDATA=/var/lib/opengauss/data --volume=/var/lib/opengauss/data:/var/lib/opengauss/data --privileged --workdir=/ -p 5432:5432 --restart=no --label=&#x27;CREATE_DATE=2022-10&#x27; --label=&#x27;GAUSS_SERVER=openGauss-5.0.0&#x27; --label=&#x27;MAIL=heguofeng@huawei.com&#x27; --runtime=runc -d opengauss/opengauss:5.0.0</span><br></pre></td></tr></table></figure>

<h1 id="opengauss2-1-0"><a href="#opengauss2-1-0" class="headerlink" title="opengauss2.1.0"></a>opengauss2.1.0</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name opengauss2.1.0 --privileged=true -d -e GS_PASSWORD=P@ssw0rd -u root -p 5432:5432 enmotech/opengauss:2.1.0</span><br></pre></td></tr></table></figure>

<h1 id="oracel"><a href="#oracel" class="headerlink" title="oracel"></a>oracel</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name oracle-db -p 1521:1521 --privileged -e ORACLE_PWD=123456 -e ORACLE_CHARACTERSET=utf8mb4 -v /opt/oracle/oradata container-registry.oracle.com/database/free:latest</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://container-registry.oracle.com/ords/f?p=113:4:13054629146525:::4:P4_REPOSITORY,AI_REPOSITORY,AI_REPOSITORY_NAME,P4_REPOSITORY_NAME,P4_EULA_ID,P4_BUSINESS_AREA_ID:1863,1863,Oracle%20Database%20Free,Oracle%20Database%20Free,1,0&cs=3AJX-e6QGdNtweUNwoM_S6Bx1QBnHxTQChj06uKkm5-wObbTXatpBsvWpkNOZlJJdiGb7W-BEXdATDDaCQn1gOw">文档</a></p>
<h1 id="redis"><a href="#redis" class="headerlink" title="redis"></a>redis</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name redis --net host --privileged=true -v /data/redis/share/redis-node-1:/data redis --requirepass 123456 --appendonly yes --port 6381</span><br></pre></td></tr></table></figure>
            
        </div>
    </div>
    <div class="post-tags">
        
        
    </div>
    <a href="/2023/09/04/docker-launch/" class="go-post">阅读全文</a>
</div>

<div class="post post-partial-show">
    <a href="/2023/09/04/mysql_to_opengauss/">
        <h2 class="post-title">MySQL迁移到高斯数据库</h2>
    </a>
    <div class="category-and-date">
        
        <span class="category">
            <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%81%E7%A7%BB/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                数据库迁移
            </a>
        </span>
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2023/9/4
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <h1 id="1-前言"><a href="#1-前言" class="headerlink" title="1. 前言"></a>1. 前言</h1><p>公司要求项目去适配高斯数据库，看了一下，高斯数据库就可以当做postgresql用，有啥问题把高斯换成postgresql来查就行。<br>其实整个项目没有太大的变动，只是几个函数需要改一下，如果用mybatis就更简单了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> VendorDatabaseIdProvider <span class="title function_">vendorDatabaseIdProvider</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">VendorDatabaseIdProvider</span> <span class="variable">vendorDatabaseIdProvider</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VendorDatabaseIdProvider</span>();</span><br><span class="line">    <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">    properties.put(<span class="string">&quot;MySQL&quot;</span>, <span class="string">&quot;mysql&quot;</span>);</span><br><span class="line">    properties.put(<span class="string">&quot;Oracle&quot;</span>, <span class="string">&quot;oracle&quot;</span>);</span><br><span class="line">    properties.put(<span class="string">&quot;PostgreSQL&quot;</span>, <span class="string">&quot;pgsql&quot;</span>);</span><br><span class="line">    properties.put(<span class="string">&quot;DM DBMS&quot;</span>, <span class="string">&quot;dm&quot;</span>);</span><br><span class="line">    vendorDatabaseIdProvider.setProperties(properties);</span><br><span class="line">    <span class="keyword">return</span> vendorDatabaseIdProvider;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> SqlSessionFactoryBean <span class="title function_">sqlSessionFactoryBean</span><span class="params">(<span class="meta">@Qualifier(&quot;dataSource&quot;)</span> DataSource dataSource)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">SqlSessionFactoryBean</span> <span class="variable">factoryBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBean</span>();</span><br><span class="line">    factoryBean.setDataSource(dataSource);</span><br><span class="line">    factoryBean.setDatabaseIdProvider(databaseIdProvider());</span><br><span class="line">    factoryBean.setMapperLocations(<span class="keyword">new</span> <span class="title class_">PathMatchingResourcePatternResolver</span>().getResources(mapperLocations));</span><br><span class="line">    <span class="keyword">return</span> factoryBean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>添加上面配置后，碰到不兼容的函数可以这样处理：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&amp;lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;maxid&quot;</span> <span class="attr">databaseId</span>=<span class="string">&quot;pgsql&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;int&quot;</span>&amp;gt;</span></span><br><span class="line">    select another_max(power_id) from tb_xx</span><br><span class="line"><span class="tag">&amp;lt;/<span class="name">select</span>&amp;gt;</span></span><br><span class="line"><span class="comment">&amp;lt;!-- 给一个默认的 --&amp;gt;</span></span><br><span class="line"><span class="tag">&amp;lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;maxid&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;int&quot;</span>&amp;gt;</span></span><br><span class="line">    select max(power_id) from tb_xx</span><br><span class="line"><span class="tag">&amp;lt;/<span class="name">select</span>&amp;gt;</span></span><br></pre></td></tr></table></figure>
<p>这样idea会爆红，可能看着有点不舒服。</p>
<p>也可以考虑这样写：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&amp;lt;<span class="name">choose</span>&amp;gt;</span></span><br><span class="line">    <span class="tag">&amp;lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;_databaseId == &#x27;oracle&#x27;&quot;</span>&amp;gt;</span></span><br><span class="line">        xxx</span><br><span class="line">    <span class="tag">&amp;lt;/<span class="name">when</span>&amp;gt;</span></span><br><span class="line">    <span class="tag">&amp;lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;_databaseId == &#x27;dm&#x27;&quot;</span>&amp;gt;</span></span><br><span class="line">        xxx</span><br><span class="line">    <span class="tag">&amp;lt;/<span class="name">when</span>&amp;gt;</span></span><br><span class="line">    <span class="tag">&amp;lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;_databaseId == &#x27;mysql&#x27;&quot;</span>&amp;gt;</span></span><br><span class="line">        xxx</span><br><span class="line">    <span class="tag">&amp;lt;/<span class="name">when</span>&amp;gt;</span></span><br><span class="line">    <span class="tag">&amp;lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;_databaseId == &#x27;informix&#x27; or _databaseId == &#x27;gbase8s&#x27;&quot;</span>&amp;gt;</span></span><br><span class="line">        xxx</span><br><span class="line">    <span class="tag">&amp;lt;/<span class="name">when</span>&amp;gt;</span></span><br><span class="line">    <span class="tag">&amp;lt;<span class="name">otherwise</span>&amp;gt;</span></span><br><span class="line">        xxx</span><br><span class="line">    <span class="tag">&amp;lt;/<span class="name">otherwise</span>&amp;gt;</span></span><br><span class="line"><span class="tag">&amp;lt;/<span class="name">choose</span>&amp;gt;</span></span><br></pre></td></tr></table></figure>

<p>两种都可以，如果太复杂了建议用第一种。</p>
<hr>
<p>本来到这，已经完事大吉了，就去mapper里面去检查一下有没有哪个函数是高斯没有的，然后改一下就行。</p>
<p>结果，万万没想到，项目里面有拿StringBuilder搞SQL拼串的代码，结果写的全是坑，这玩意狠狠折磨了我好几个星期！</p>
<h1 id="2-别名问题"><a href="#2-别名问题" class="headerlink" title="2. 别名问题"></a>2. 别名问题</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id <span class="keyword">AS</span> userId <span class="keyword">FROM</span> <span class="keyword">user</span></span><br></pre></td></tr></table></figure>
<p>上面这个SQL很简单，就是查用户id，然后起个别名叫<code>userId</code>，乍一看好像没什么，下面我放个图，大家来找不同：</p>
<p><img lazy="https://selfb.asia/public/2023-9/Snipaste_2023-09-26_10-45-53.webp" alt="找不同"></p>
<p>发现了吗？仔细看一下userId，有没有发现查出来全部变成小写了？</p>
<p>在我们项目代码里，直接从结果集里面拿userId，结果拿不到爆空指针！</p>
<p>原本我以为是配置问题，把大小写搞得不敏感了，结果去网上搜了一下，结果只有表名能修改大小写敏感。</p>
<p>所以要怎么改呢，其实只需要在别名的左右加上双引号就行了：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id <span class="keyword">AS</span> &quot;userId&quot; <span class="keyword">FROM</span> <span class="keyword">user</span></span><br></pre></td></tr></table></figure>
<p>这个操作同样兼容mysql。</p>
<h1 id="3-COUNT"><a href="#3-COUNT" class="headerlink" title="3. COUNT(*)"></a>3. COUNT(*)</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> userId</span><br></pre></td></tr></table></figure>

<p>又是一个非常简单的SQL，然后咱们又来找不同：</p>
<p>高斯的结果：</p>
<p><img lazy="https://selfb.asia/public/2023-9/gs-count.webp" alt="gs-count"></p>
<p>mysql的结果：</p>
<p><img lazy="https://selfb.asia/public/2023-9/mysql-count.webp" alt="mysql-count"></p>
<p>相信一眼就能看出来，mysql拿需要用<code>COUNT(*)</code>，而高斯则需要用<code>count</code>拿。</p>
<p>这里最好的解决办法就只有取别名了，全部都叫同一个就行了。</p>
<h1 id="不兼容的函数-语法"><a href="#不兼容的函数-语法" class="headerlink" title="不兼容的函数&#x2F;语法"></a>不兼容的函数&#x2F;语法</h1><table>
<thead>
<tr>
<th align="center">MySql函数名</th>
<th align="center">高斯函数名</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">LIMIT offset, size</td>
<td align="center">LIMIT size OFFSET offset</td>
<td align="center">高斯不支持mysql的语法，Mysql支持高斯的语法，更换时注意offset和size的位置需要交换</td>
</tr>
<tr>
<td align="center">group_concat(col)</td>
<td align="center">array_to_string(array_agg(col), ‘,’)</td>
<td align="center">group_concat</td>
</tr>
<tr>
<td align="center">date_format(col, ‘%Y-%m-%d’)</td>
<td align="center">to_char(col, ‘yyyy-mm-dd’)</td>
<td align="center">日期转字符串</td>
</tr>
<tr>
<td align="center">delete from tb1, tb2</td>
<td align="center">不兼容，推荐使用子查询</td>
<td align="center">mysql 删除时选择两张表，高斯不支持</td>
</tr>
<tr>
<td align="center">IFNULL(xx, fallback)</td>
<td align="center">COALESCE(xx, fallback)</td>
<td align="center">当列为空时使用默认值</td>
</tr>
</tbody></table>

            
        </div>
    </div>
    <div class="post-tags">
        
        
    </div>
    <a href="/2023/09/04/mysql_to_opengauss/" class="go-post">阅读全文</a>
</div>

<div class="post post-partial-show">
    <a href="/2023/08/30/tomcat-custom-https/">
        <h2 class="post-title">通过环境变量传递Tomcat https证书密码</h2>
    </a>
    <div class="category-and-date">
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2023/8/30
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <h1 id="1-起因"><a href="#1-起因" class="headerlink" title="1. 起因"></a>1. 起因</h1><p>由于最近公司要求给tomcat配置https，本来以为只是简单的塞个证书和私钥就行了：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">&amp;lt;</span>Connector port=&quot;8443&quot; protocol=&quot;org.apache.coyote.http11.Http11NioProtocol&quot; SSLEnabled=&quot;true&quot; <span class="symbol">&amp;gt;</span></span><br><span class="line">    <span class="symbol">&amp;lt;</span>SSLHostConfig protocols=&quot;TLSv1.2&quot; sslProtocol=&quot;TLS&quot;<span class="symbol">&amp;gt;</span></span><br><span class="line">        <span class="symbol">&amp;lt;</span>Certificate certificateKeyFile=&quot;conf/server.key&quot;</span><br><span class="line">                    certificateFile=&quot;conf/server.crt&quot;</span><br><span class="line">                    type=&quot;RSA&quot;/<span class="symbol">&amp;gt;</span></span><br><span class="line">    <span class="symbol">&amp;lt;</span>/SSLHostConfig<span class="symbol">&amp;gt;</span></span><br><span class="line"><span class="symbol">&amp;lt;</span>/Connector<span class="symbol">&amp;gt;</span></span><br></pre></td></tr></table></figure>

<p>结果要求用jks证书文件，彳亍：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">&amp;lt;</span>Connector port=&quot;8443&quot; protocol=&quot;org.apache.coyote.http11.Http11NioProtocol&quot; </span><br><span class="line">    sslProtocol=&quot;TLS&quot; </span><br><span class="line">    protocols=&quot;TLSv1.2&quot;</span><br><span class="line">    SSLEnabled=&quot;true&quot;</span><br><span class="line">    keystoreFile=&quot;conf/server.keystore&quot;</span><br><span class="line">    keystorePass=&quot;xxxx&quot;/<span class="symbol">&amp;gt;</span></span><br></pre></td></tr></table></figure>
<p>本以为万事大吉，结果甲方爸爸因为密码是直接写的明文，要求我们必须把密码穿成加密的🥲。</p>
<p>不过还好顺带也给了我份博客：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/suncoolcat/p/3292252.html">tomcat安全配置之证书密码加密存储</a></p>
<h1 id="2-tomcat配置https"><a href="#2-tomcat配置https" class="headerlink" title="2. tomcat配置https"></a>2. tomcat配置https</h1><h2 id="2-1-编写实现类"><a href="#2-1-编写实现类" class="headerlink" title="2.1 编写实现类"></a>2.1 编写实现类</h2><p>其实这份博客已经说的很清楚了，只需要继承<code>Http11NioProtocol</code>这个类就可以了</p>
<blockquote>
<p>博客里用的<code>Http11Protocol</code>，这个类已经被标记为<code>@Deprecated</code>的了，所以我们直接用它的父类，效果是一样的。</p>
</blockquote>
<p>但是这个博客还是不太完整，这个类怎么打jar包？<code>Http11Protocol</code>从哪里来？打了的jar包丢在哪里？博客里都没有说明。</p>
<p>这里我自己研究了一下，首先创建一个maven项目，pom.xml添加依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">&amp;lt;</span>dependency<span class="symbol">&amp;gt;</span></span><br><span class="line">    <span class="symbol">&amp;lt;</span>groupId<span class="symbol">&amp;gt;</span>org.apache.tomcat<span class="symbol">&amp;lt;</span>/groupId<span class="symbol">&amp;gt;</span></span><br><span class="line">    <span class="symbol">&amp;lt;</span>artifactId<span class="symbol">&amp;gt;</span>tomcat-coyote<span class="symbol">&amp;lt;</span>/artifactId<span class="symbol">&amp;gt;</span></span><br><span class="line">    <span class="symbol">&amp;lt;</span>version<span class="symbol">&amp;gt;</span>8.5.87<span class="symbol">&amp;lt;</span>/version<span class="symbol">&amp;gt;</span></span><br><span class="line">    <span class="symbol">&amp;lt;</span>scope<span class="symbol">&amp;gt;</span>provided<span class="symbol">&amp;lt;</span>/scope<span class="symbol">&amp;gt;</span></span><br><span class="line"><span class="symbol">&amp;lt;</span>/dependency<span class="symbol">&amp;gt;</span></span><br></pre></td></tr></table></figure>
<p>注意scope是provided。</p>
<p>之后就可以直接写代码了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.coyote.http11.Http11NioProtocol;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EncryptedHttp11Protocol</span> <span class="keyword">extends</span> <span class="title class_">Http11NioProtocol</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 进行你自己的密码获取逻辑</span></span><br><span class="line">        setKeystorePass(<span class="string">&quot;xxx&quot;</span>);</span><br><span class="line">        <span class="built_in">super</span>.init();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>写完直接用maven打包：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn package -DskipTests</span><br></pre></td></tr></table></figure>

<p>然后丢到tomcat目录的lib文件夹里就可以了。</p>
<p>最后配置server.xml：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> <span class="symbol">&amp;lt;</span>Connector port=&quot;8443&quot; protocol=&quot;xxxxxxx.EncryptedHttp11Protocol&quot; SSLEnabled=&quot;true&quot;</span><br><span class="line">    keystoreFile=&quot;conf/server.keystore&quot;</span><br><span class="line">    sslProtocol=&quot;TLS&quot;<span class="symbol">&amp;gt;</span></span><br><span class="line"><span class="symbol">&amp;lt;</span>/Connector<span class="symbol">&amp;gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>注意protocol属性要改成你自己的实现类</strong></p>
<h2 id="2-2-设置环境变量"><a href="#2-2-设置环境变量" class="headerlink" title="2.2 设置环境变量"></a>2.2 设置环境变量</h2><p>由于jks被加密，需要提供密码，因此推荐的方法是通过系统环境变量来提供（这里直接根据自己的机器设置即可）。<br>在java代码里这样获取系统环境变量：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> System.getenv(key);</span><br></pre></td></tr></table></figure>

<h2 id="2-3-设置命令行参数"><a href="#2-3-设置命令行参数" class="headerlink" title="2.3 设置命令行参数"></a>2.3 设置命令行参数</h2><p>也可以通过设置tomcat命令行参数来传输秘钥，<br>在tomcat的bin目录下创建setenv.bat(windows) &#x2F; setenv.sh (linux)文件，并且配置相关参数即可。</p>
<p>windows: </p>
<figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> &quot;JAVA_OPTS=-DsecretKey=xxxx -DsercretKey2=xxxx&quot;</span><br></pre></td></tr></table></figure>

<p>linux:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JAVA_OPTS=&quot;-DsecretKey=xxxx -DsercretKey2=xxxx&quot;</span><br></pre></td></tr></table></figure>

<p>之后在代码中这样获取：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> System.getProperty(key);</span><br></pre></td></tr></table></figure>

<h1 id="3-SpringBoot内嵌tomcat配置https"><a href="#3-SpringBoot内嵌tomcat配置https" class="headerlink" title="3. SpringBoot内嵌tomcat配置https"></a>3. SpringBoot内嵌tomcat配置https</h1><p>你说的对，但是我是SpringBoot内嵌tomcat！</p>
<p>公司的众多模块中，偏偏就是有一个SpringBoot项目，这玩意用的内嵌tomcat，上面的方法都用不了👎👎👎。</p>
<p>首先我们要知道SpringBoot项目怎么开启https：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">ssl:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">key-store:</span> <span class="string">classpath:server.keystore</span></span><br><span class="line">        <span class="attr">key-store-password:</span> <span class="string">xxxxxx</span></span><br></pre></td></tr></table></figure>

<p>我们只需要找到一个方法在配置ssl前修改配置，提供密码即可。</p>
<p>你别说，还真被我找到了，在启动类添加下面的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> WebServerFactoryCustomizer&amp;lt;UndertowServletWebServerFactory&amp;gt; <span class="title function_">webServerFactoryCustomizer</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> factory -&amp;gt; &#123;</span><br><span class="line">        <span class="type">Ssl</span> <span class="variable">ssl</span> <span class="operator">=</span> factory.getSsl();</span><br><span class="line">        <span class="keyword">if</span> (ssl == <span class="literal">null</span> || !ssl.isEnabled()) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ... 获取秘钥</span></span><br><span class="line"></span><br><span class="line">        ssl.setKeyStorePassword(<span class="string">&quot;xxxx&quot;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>甚至你在这里还可以引用刚才为tomcat准备的jar包，直接使用里面的秘钥获取逻辑，就不用再写一遍了√。</p>
<h1 id="4-其它：由证书和私钥生成jks文件"><a href="#4-其它：由证书和私钥生成jks文件" class="headerlink" title="4. 其它：由证书和私钥生成jks文件"></a>4. 其它：由证书和私钥生成jks文件</h1><p>首先执行命令生成p12文件（输入后会要求输入密码，直接填上你要的密码就行）：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl pkcs12 -export -in server.crt -inkey server.key -out server.p12</span><br></pre></td></tr></table></figure>

<p>输完后执行：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keytool -importkeystore -v -srckeystore server.p12 -srcstoretype pkcs12 -srcstorepass 上面的密码 -destkeystore server.keystore -destoretype jks -deststorepass 上面的密码</span><br></pre></td></tr></table></figure>

<p>这里如果jdk版本过低会报错：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">keytool 错误: java.io.IOException: parseAlgParameters failed: ObjectIdentifier() -- data isn<span class="string">&#x27;t an object ID (tag = 48)</span></span><br><span class="line"><span class="string">java.io.IOException: parseAlgParameters failed: ObjectIdentifier() -- data isn&#x27;</span>t an object <span class="title function_">ID</span> <span class="params">(tag = <span class="number">48</span>)</span></span><br><span class="line">        at sun.security.pkcs12.PKCS12KeyStore.parseAlgParameters(PKCS12KeyStore.java:<span class="number">816</span>)</span><br><span class="line">        at sun.security.pkcs12.PKCS12KeyStore.engineLoad(PKCS12KeyStore.java:<span class="number">2018</span>)</span><br><span class="line">        at java.security.KeyStore.load(KeyStore.java:<span class="number">1445</span>)</span><br><span class="line">        at sun.security.tools.keytool.Main.loadSourceKeyStore(Main.java:<span class="number">2040</span>)</span><br><span class="line">        at sun.security.tools.keytool.Main.doCommands(Main.java:<span class="number">1067</span>)</span><br><span class="line">        at sun.security.tools.keytool.Main.run(Main.java:<span class="number">366</span>)</span><br><span class="line">        at sun.security.tools.keytool.Main.main(Main.java:<span class="number">359</span>)</span><br><span class="line">Caused by: java.io.IOException: ObjectIdentifier() -- data isn<span class="string">&#x27;t an object ID (tag = 48)</span></span><br><span class="line"><span class="string">        at sun.security.util.ObjectIdentifier.&amp;lt;init&amp;gt;(ObjectIdentifier.java:257)</span></span><br><span class="line"><span class="string">        at sun.security.util.DerInputStream.getOID(DerInputStream.java:314)</span></span><br><span class="line"><span class="string">        at com.sun.crypto.provider.PBES2Parameters.engineInit(PBES2Parameters.java:267)</span></span><br><span class="line"><span class="string">        at java.security.AlgorithmParameters.init(AlgorithmParameters.java:293)</span></span><br><span class="line"><span class="string">        at sun.security.pkcs12.PKCS12KeyStore.parseAlgParameters(PKCS12KeyStore.java:812)</span></span><br><span class="line"><span class="string">        ... 6 more</span></span><br></pre></td></tr></table></figure>
<p>这里用的jdk1.8.0_241导致的报错，换成jdk-11.0.18可以正常执行，其它版本暂未测试。</p>

            
        </div>
    </div>
    <div class="post-tags">
        
        
    </div>
    <a href="/2023/08/30/tomcat-custom-https/" class="go-post">阅读全文</a>
</div>

<div class="post post-partial-show">
    <a href="/2023/05/04/svn/">
        <h2 class="post-title">svn</h2>
    </a>
    <div class="category-and-date">
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2023/5/4
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <h1 id="1-下载安装"><a href="#1-下载安装" class="headerlink" title="1. 下载安装"></a>1. 下载安装</h1><p><a target="_blank" rel="noopener" href="https://www.tortoisesvn.net/downloads.zh.html">下载 · TortoiseSVN</a></p>
<p>直接下载安装包即可，下载完成后不需要配置环境变量之类的，SVN也不需要你去命令行里去敲哪些什么指令，它自己有很丰富的图形客户端，这点是比GIT好一点点的。</p>
<p>直接对着任意地方右键，如果出现<code>TortoiseSVN</code>的选项，就说明安装成功了（对着桌面按是没有的，需要进随便一个文件夹）。</p>
<h1 id="2-创建仓库"><a href="#2-创建仓库" class="headerlink" title="2. 创建仓库"></a>2. 创建仓库</h1><p>SVN不支持离线操作，也就是说你想要创建一个仓库，你必须先去服务器支棱一个起来，这里我们直接用码云（<a target="_blank" rel="noopener" href="https://gitee.com/">工作台 - Gitee.com</a>）就好了。</p>
<p>随便创建一个项目，点击管理 -&amp;gt; 功能设置 -&amp;gt; 启用SVN访问。</p>
<p>之后克隆项目，记得要选SVN的协议：</p>
<p><img lazy="https://selfb.asia/public/svn/2023-4-4-f7e03d78-69bd-4d0e-99dd-7f795e9bb813.webp" alt="克隆地址"></p>
<p>之后进入任意文件夹，鼠标右键，点击<code>Checkout</code>，之后会弹出来这个：</p>
<p><img lazy="https://selfb.asia/public/svn/2023-4-4-4c484952-5b77-4b8f-a1e0-d608c149731d.webp" alt="Checkout"></p>
<p>第一个表单就是我们的仓库地址，第二个就是我们要将项目拉到的地方，第三<code>Checkout Depth</code>就是你克隆的深度，你可以选择全部复制（Fully recursive），也可以选择部分，一般配合下面的<code>Choose items</code>按钮使用。</p>
<p>Omit externals表示忽略外部设备，目前不是很清楚有什么用。</p>
<p>最后一个框（Revision）就是版本信息选择了，你可以直接选择最新分支（HEAD revision），也可以通过<code>Show log</code>选择历史分支来进行克隆。</p>
<p>选好后点击OK进行克隆。</p>
<h1 id="3-提交修改"><a href="#3-提交修改" class="headerlink" title="3. 提交修改"></a>3. 提交修改</h1><p>我们在本地进行任意修改，修改完后在任意子目录或者根目录鼠标右键，在<code>TortoiseSVN</code>选项下找到<code>Commit</code>选项，点开会出现这个：</p>
<p><img lazy="https://selfb.asia/public/svn/2023-4-4-f6b3b8a9-a01e-4918-8f6d-5febeaba9268.webp" alt="Commit"></p>
<p>最上面的<code>Message</code>就是提交信息，没有什么好说的。</p>
<p>下面那个框就是选择你需要提交的文件。</p>
<p><font color=red><strong>注意：SVN的Commit会直接提交到服务器，它不是跟Git一样本地提交！！！千万不要乱提交。</strong></font></p>
<p>下面有个按钮，分别的作用是：</p>
<ul>
<li>Show unversioned files：显示被排除的文件（不受版本控制的文件）</li>
</ul>
<p>其它的暂时用不上，我们选好后，直接提交，然后再去码云上看，就可以看到提交结果了。</p>
<h1 id="4-解决冲突"><a href="#4-解决冲突" class="headerlink" title="4. 解决冲突"></a>4. 解决冲突</h1><p>这里我们先在码云上修改一下，然后也在本地修改同样的文件，然后在本地提交：</p>
<p><img lazy="https://selfb.asia/public/svn/2023-4-4-be381ad9-6523-406d-9d22-494a2fc9dc81.webp" alt="Commit failed"></p>
<p>提交失败了，可以发现它让我们去更新：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You have to update your working copy first</span><br></pre></td></tr></table></figure>

<p>那我们就更新，直接项目目录下右键，点击<code>Update</code>，结果又报错了：</p>
<p><img lazy="https://selfb.asia/public/svn/2023-4-4-f69a5b86-d6c6-42d8-a8e4-ba19423d7380.webp" alt="Update failed"></p>
<p>可以发现是因为出现了文件冲突，和Git一样，我们需要先解决冲突后再提交。</p>
<p>这里是我本地的文件内容：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">hello world</span><br><span class="line">hello world</span><br><span class="line">hello world</span><br><span class="line">hello world</span><br><span class="line"></span><br><span class="line">12312</span><br><span class="line">312</span><br><span class="line">3</span><br><span class="line">12</span><br><span class="line">3</span><br><span class="line">12</span><br><span class="line">3</span><br><span class="line">12</span><br><span class="line">3</span><br><span class="line">hello world</span><br></pre></td></tr></table></figure>

<p>这是服务器的：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">hello world</span><br><span class="line"></span><br><span class="line">12312</span><br><span class="line">312</span><br><span class="line">3</span><br><span class="line">12</span><br><span class="line">3</span><br><span class="line">12</span><br><span class="line">3</span><br><span class="line">12</span><br><span class="line">3</span><br><span class="line">12312</span><br><span class="line">312</span><br><span class="line">3</span><br><span class="line">12</span><br><span class="line">3</span><br><span class="line">12</span><br><span class="line">3</span><br><span class="line">12</span><br><span class="line">3</span><br><span class="line">123312312</span><br></pre></td></tr></table></figure>

<p>这是发生冲突后的文件：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">hello world</span><br><span class="line">hello world</span><br><span class="line">hello world</span><br><span class="line">hello world</span><br><span class="line"></span><br><span class="line">&amp;lt;&amp;lt;&amp;lt;&amp;lt;&amp;lt;&amp;lt;&amp;lt; .mine</span><br><span class="line">hello world</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">||||||| .r3</span><br><span class="line">12312</span><br><span class="line">312</span><br><span class="line">3</span><br><span class="line">12</span><br><span class="line">3</span><br><span class="line">12</span><br><span class="line">3</span><br><span class="line">12</span><br><span class="line">3=======</span><br><span class="line">12312</span><br><span class="line">312</span><br><span class="line">3</span><br><span class="line">12</span><br><span class="line">3</span><br><span class="line">12</span><br><span class="line">3</span><br><span class="line">12</span><br><span class="line">3</span><br><span class="line">123312312&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt; .r4</span><br></pre></td></tr></table></figure>

<p>这特么谁看得懂，别急，还记得之前我说过SVN有丰富的图形客户端吗？这里就还真有解决冲突用的玩意：</p>
<p><img lazy="https://selfb.asia/public/svn/2023-4-4-bd001ea3-fca1-4b2d-9950-64f0e52cc430.webp" alt="Edit conflicts"></p>
<p>打开后就非常直观了，这里就不放图了，修改完后点击左上角的<code>Save</code>保存，这时它会问你冲突是否已经解决完毕了，如果选择解决完了（Mark as resolved），就可以直接提交了。当然如果又冲突了，就又需要重复上述过程。</p>
<h1 id="5-代码暂存"><a href="#5-代码暂存" class="headerlink" title="5. 代码暂存"></a>5. 代码暂存</h1><p>待补坑。</p>

            
        </div>
    </div>
    <div class="post-tags">
        
        
    </div>
    <a href="/2023/05/04/svn/" class="go-post">阅读全文</a>
</div>

<div class="post post-partial-show">
    <a href="/2023/04/20/docker/">
        <h2 class="post-title">Docker</h2>
    </a>
    <div class="category-and-date">
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2023/4/20
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <p><a href="/docker/quick-start">快速入门</a></p>
<p><a href="/docker/advance">进阶使用</a></p>
<p><a href="/docker/docker-file">Dockerfile</a></p>

            
        </div>
    </div>
    <div class="post-tags">
        
        
    </div>
    <a href="/2023/04/20/docker/" class="go-post">阅读全文</a>
</div>


            <div class="page-current">
    <div class="prev">
        
        <a class="page-num" href="/">
            <i class="fa-solid fa-caret-left fa-fw"></i>
        </a>
        
    </div>
    <div class="page-index">
        
        <span>
            
            
            <a class="page-num" href="/">1</a>
        </span>
        
        <span class="current">2</span>
        
        <span>
            <a class="page-num" href="/page/3/">3</a>
            
            <a class="page-num" href="/page/4">4</a>
            
            
        </span>
        
    </div>
    <div class="next">
        
        <a class="page-num" href="/page/3/">
            <i class="fa-solid fa-caret-right fa-fw"></i>
        </a>
        
    </div>
</div>

        </div>
    </div>
    
    <div id="home-card">
        <div id="card-div">
    <div class="card-style" style="width: 300px">
        <div class="avatar">
            <img src="https://selfb.asia/avatar/1.webp" alt="avatar" />
        </div>
        <div class="name">IceOfSummer</div>
        <div class="description">
            <p>这个人很懒，没有个人简介</p>

        </div>
        
        
    </div>
</div>

    </div>
    
</div>

                <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2022 - 2024 IceOfSummerの博客
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;IceOfSummer
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/argvchs/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

            </div>
            </transition>
            
            <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
            </transition>
            
        </div>
        <script src="/js/main.js"></script>
        
    </body>
</html>
