
<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8" />
        <title>DockerFile | IceOfSummerの博客</title>
        <meta name="author" content="IceOfSummer" />
        <meta name="description" content="用来用去还是自己搭的博客靠谱" />
        <meta name="keywords" content="" />
        <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />
        <script src="https://cdn.staticfile.org/vue/3.2.47/vue.global.prod.min.js"></script>
<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/6.3.0/css/all.min.css" />
<link rel="stylesheet" href="https://selfb.asia/static/particlex/static/fonts.min.css" />
<script>
  const mixins = {};
  const h = (arg1, arg2, arg3) => {
    if (arg2.attrs) {
      Object.assign(arg2, arg2.attrs)
      Reflect.deleteProperty(arg2, 'attrs')
    }
    if (arg2.on) {
      Object.keys(arg2.on).forEach(key => {
        const head = key.charAt(0).toUpperCase()
        arg2['on' + head  + key.substring(1)] = arg2.on[key]
      })
      Reflect.deleteProperty(arg2, 'on')
    }
    return Vue.h(arg1, arg2, arg3)
  }
</script>

<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>


<script src="https://cdn.staticfile.org/highlight.js/11.7.0/highlight.min.js"></script>
<link
    rel="stylesheet"
    href="https://cdn.staticfile.org/highlight.js/11.7.0/styles/github.min.css"
/>
<script src="/js/lib/highlight.js"></script>



<script src="/js/lib/preview.js"></script>









<link rel="stylesheet" href="/css/main.css" />

  <script src="/js/lib/toc.js"></script>



  <script src="/js/lib/lazy-load-support.js"></script>


    <meta name="generator" content="Hexo 6.3.0"></head>
    <body>
        <div id="layout">
            <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>加载过慢请开启缓存&ensp;浏览器默认开启</p>
                    <img src="/images/loading.gif" />
                </div>
            </div>
            </transition>
            <transition name="into">
            <div id="main" v-show="!loading">
                <nav id="menu" ref="menu">
    <div class="desktop-menu">
        <a class="title" href="/">
            <span>ICEOFSUMMERの博客</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
    </div>
    <div id="mobile-menu">
        <div class="curtain" v-show="showMenu" @click="showMenu = !showMenu"></div>
        <div class="title" @click="showMenu = !showMenu">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;ICEOFSUMMERの博客</span>
        </div>
        <transition name="slide">
        <div class="items" v-show="showMenu">
            
            <a href="/">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-house fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                </div>
            </a>
            
            <a href="/about">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-id-card fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                </div>
            </a>
            
            <a href="/archives">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-box-archive fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                </div>
            </a>
            
            <a href="/categories">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-bookmark fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                </div>
            </a>
            
            <a href="/tags">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-tags fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                </div>
            </a>
            
        </div>
        </transition>
    </div>
</nav>

                <div class="article">
    <div>
        <h1>DockerFile</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2023/4/25
        </span>
        
        <span class="category">
            <a href="/2023/04/20/docker/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                Docker
            </a>
        </span>
        
        
    </div>
    
    <toc-component></toc-component>
    <div class="content" v-pre id="main-content">
        <h1 id="1-基础"><a href="#1-基础" class="headerlink" title="1. 基础"></a>1. 基础</h1><p>Dockerfile是用来构建Docker镜像的文本文件，是由一条条构建镜像所需的指令和参数构成的脚本。</p>
<p><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/builder/">Dockerfile reference | Docker Documentation</a></p>
<h2 id="1-1-DockerFile执行流程"><a href="#1-1-DockerFile执行流程" class="headerlink" title="1.1 DockerFile执行流程"></a>1.1 DockerFile执行流程</h2><ol>
<li>docker从基础镜像运行一个容器</li>
<li>执行一条指令并对容器作出修改</li>
<li>执行类似<code>docker commit</code>的操作提交一个新的镜像层</li>
<li>docker再基于刚提交的镜像运行一个新容器</li>
<li>执行dockerfile中的下一条指令直到所有指令都执行完成</li>
</ol>
<h2 id="1-2-DockerFile常用保留字"><a href="#1-2-DockerFile常用保留字" class="headerlink" title="1.2 DockerFile常用保留字"></a>1.2 DockerFile常用保留字</h2><ul>
<li><p>FROM：基础镜像，当前新镜像是基于哪个镜像的，指定一个已经存在的镜像作为基础镜像</p>
</li>
<li><p>MAINTAINER：镜像维护者的姓名和邮箱地址</p>
</li>
<li><p>RUN：容器构建时需要执行的命令</p>
<ul>
<li>Shell格式：<code>RUN 命令</code></li>
<li>Exec格式：<code>RUN [可执行文件, 参数1, 参数2, ...]</code><ul>
<li>例如：<code>RUN [&#39;test.sh&#39;, &#39;dev&#39;, &#39;offline&#39;]</code>等价于<code>RUN test.sh dev offline</code></li>
</ul>
</li>
</ul>
</li>
<li><p>EXPOSE：容器对外暴露的端口</p>
</li>
<li><p>WORKDIR：指定在创建容器后，终端默认登陆进来的工作目录(登陆终端后的默认路径)</p>
</li>
<li><p>USER：指定该镜像以什么样的用户去执行，默认为ROOT</p>
</li>
<li><p>ENV：用来在构建过程中设置环境变量</p>
</li>
<li><p>VOLUME：指定容器数据卷</p>
</li>
<li><p>ADD：将宿主机目录下的文件拷贝进镜像（会自动处理URL和解压tar压缩包）</p>
</li>
<li><p>COPY：拷贝文件和目录到镜像中</p>
</li>
<li><p>CMD：指定容器启动后要干的事情，<font color=red>若有多个CMD，则只有最后一个生效，并且CMD会被<code>docker run</code>之后的参数替换</font>。</p>
<ul>
<li><p>例如Tomcat配置文件的CMD命令如下：</p>
<pre><code class="shell">CMD [&quot;catalina.sh&quot;, &quot;run&quot;]
</code></pre>
<p>我们使用如下指令启动容器：</p>
<pre><code class="shell">docker run -it -p 8080:8080 [TOMCAT镜像ID] /bin/bash
</code></pre>
<p>则命令会被替换成这样：</p>
<pre><code class="shell">CMD [&quot;/bin/bash&quot;, &quot;run&quot;]
</code></pre>
<p>此时TOMCAT也将启动失败</p>
</li>
</ul>
</li>
<li><p>ENTRYPOINT：指定一个容器启动时要执行的命令，类似于CMD，但区别是ENTRYPOINT不会被<code>docker run</code>后面的命令覆盖，<font color=red>而且后面的参数会被送给ENTRYPOINT指令所运行的指令。</font></p>
<p>ENTRYPOINT可以和CMD一起使用，一般是变参才会使用CMD，这里的CMD等于是在给ENTRYPOINT传参。</p>
<p>当指定了ENTRYPOINT后，CMD的含义就发生了变化，不再是直接运行其命令，而是将CMD的内容作为参数传递给ENTRYPOINT指令。</p>
<p>例如通过Dockerfile构建Nginx：</p>
<pre><code class="shell">FROM nginx

ENTRYPOINT [&quot;nginx&quot;, &quot;-c&quot;]
CMD [&quot;/etc/nginx/nginx.conf&quot;]
</code></pre>
<p><code>docker run nginx -c /etc/nginx/new.conf</code>最终会运行：<code>nginx -c /etc/nginx/new.conf</code></p>
</li>
</ul>
<h2 id="1-3-自定义镜像案例"><a href="#1-3-自定义镜像案例" class="headerlink" title="1.3 自定义镜像案例"></a>1.3 自定义镜像案例</h2><p>自定义一个centos镜像，并且具备vim+ifconfig+jdk11。</p>
<p>在Linux下创建一个<code>Dockerfile</code>文件：</p>
<pre><code class="shell">vim Dockerfile
</code></pre>
<p>添加内容：</p>
<pre><code class="dockerfile">FROM centos
MAINTAINER xds&amp;lt;2237803016@qq.com&amp;gt;

ENV MYPATH /usr/local
WORKDIR $MYPATH

# centos需要执行下面的命令，否则yum可能会报错。或者将FROM换成centos7
RUN sed -i &#39;s/mirrorlist/#mirrorlist/g&#39; /etc/yum.repos.d/CentOS-*
RUN sed -i &#39;s|#baseurl=http://mirror.centos.org|baseurl=http://vault.centos.org|g&#39; /etc/yum.repos.d/CentOS-*
RUN yum makecache

# 安装vim
RUN yum -y install vim

# 安装ifconfig
RUN yum -y install net-tools

# 安装java8
RUN yum -y install glibc.i686
RUN mkdir /usr/local/java

# 添加java文件，必须和Dockerfile在同一目录
ADD jdk-11.0.19.tar.gz /usr/local/java
# 设置java环境变量
# 这里后面的文件名就是上面压缩包的文件名，ADD指令会自动为我们解压
ENV JAVA_HOME /usr/local/java/jdk-11.0.19
ENV JRE_HOME $JAVA_HOME/jre
ENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib:$CLASSPATH
ENV PATH $JAVA_HOME/bin:$PATH

EXPOSE 80
CMD echo $MYPATH
CMD echo &quot;success--------ok&quot;
CMD /bin/bash
</code></pre>
<p>打包制作镜像（注意后面有个点）：</p>
<pre><code class="shell">docker build -t [镜像名]:[TAG] .
</code></pre>
<h1 id="2-虚悬镜像"><a href="#2-虚悬镜像" class="headerlink" title="2. 虚悬镜像"></a>2. 虚悬镜像</h1><p>如果在build的时候没有指定镜像名和TAG，在build后出来的镜像名和TAG都会为<none></p>
<p>在某些情况下由于docker的错误也会产生虚悬镜像。</p>
<p>使用如下指令查看所有虚悬镜像：</p>
<pre><code class="shell">docker images ls -f dangling=true
</code></pre>
<p>虚悬镜像没有存在的意义，可以直接删除：</p>
<pre><code class="shell">docker image prune
</code></pre>

    </div>
    
    
    
    
    <div id="comment">
        <div id="giscus-container" class="giscus"></div>
    </div>
    
    
    
    
</div>

                <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2022 - 2023 IceOfSummerの博客
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;IceOfSummer
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/argvchs/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

            </div>
            </transition>
            
            <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
            </transition>
            
        </div>
        <script src="/js/main.js"></script>
        
        
<script
    src="https://giscus.app/client.js"
    data-repo="IceOfSummer/iceofsummer.github.io"
    data-repo-id="R_kgDOJFU7OQ"
    data-category="Announcements"
    data-category-id="DIC_kwDOJFU7Oc4CUyC7"
    data-mapping="title"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="top"
    data-theme="preferred_color_scheme"
    data-lang="zh-CN"
    crossorigin
    async
></script>





        
    </body>
</html>
