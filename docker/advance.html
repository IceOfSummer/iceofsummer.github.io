
<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8" />
        <title>进阶使用 | IceOfSummerの博客</title>
        <meta name="author" content="IceOfSummer" />
        <meta name="description" content="用来用去还是自己搭的博客靠谱" />
        <meta name="keywords" content="" />
        <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />
        <script src="https://cdn.staticfile.org/vue/3.2.47/vue.global.prod.min.js"></script>
<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/6.3.0/css/all.min.css" />
<link rel="stylesheet" href="https://selfb.asia/static/particlex/static/fonts.min.css" />
<script>
  const mixins = {};
  const h = (arg1, arg2, arg3) => {
    if (arg2.attrs) {
      Object.assign(arg2, arg2.attrs)
      Reflect.deleteProperty(arg2, 'attrs')
    }
    if (arg2.on) {
      Object.keys(arg2.on).forEach(key => {
        const head = key.charAt(0).toUpperCase()
        arg2['on' + head  + key.substring(1)] = arg2.on[key]
      })
      Reflect.deleteProperty(arg2, 'on')
    }
    return Vue.h(arg1, arg2, arg3)
  }
</script>

<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>


<script src="https://cdn.staticfile.org/highlight.js/11.7.0/highlight.min.js"></script>
<link
    rel="stylesheet"
    href="https://cdn.staticfile.org/highlight.js/11.7.0/styles/github.min.css"
/>
<script src="/js/lib/highlight.js"></script>



<script src="/js/lib/preview.js"></script>









<link rel="stylesheet" href="/css/main.css" />

  <script src="/js/lib/toc.js"></script>



  <script src="/js/lib/lazy-load-support.js"></script>


    <meta name="generator" content="Hexo 7.1.1"></head>
    <body>
        <div id="layout">
            <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>加载过慢请开启缓存&ensp;浏览器默认开启</p>
                    <img src="/images/loading.gif" />
                </div>
            </div>
            </transition>
            <transition name="into">
            <div id="main" v-show="!loading">
                <nav id="menu" ref="menu">
    <div class="desktop-menu">
        <a class="title" href="/">
            <span>ICEOFSUMMERの博客</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
    </div>
    <div id="mobile-menu">
        <div class="curtain" v-show="showMenu" @click="showMenu = !showMenu"></div>
        <div class="title" @click="showMenu = !showMenu">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;ICEOFSUMMERの博客</span>
        </div>
        <transition name="slide">
        <div class="items" v-show="showMenu">
            
            <a href="/">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-house fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                </div>
            </a>
            
            <a href="/about">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-id-card fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                </div>
            </a>
            
            <a href="/archives">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-box-archive fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                </div>
            </a>
            
            <a href="/categories">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-bookmark fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                </div>
            </a>
            
            <a href="/tags">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-tags fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                </div>
            </a>
            
        </div>
        </transition>
    </div>
</nav>

                <div class="article">
    <div>
        <h1>进阶使用</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2023/4/23
        </span>
        
        <span class="category">
            <a href="/2023/04/20/docker/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                Docker
            </a>
        </span>
        
        
    </div>
    
    <toc-component></toc-component>
    <div class="content" v-pre id="main-content">
        <h1 id="1-MySQL部署"><a href="#1-MySQL部署" class="headerlink" title="1. MySQL部署"></a>1. MySQL部署</h1><h2 id="1-1-MySQL主从配置"><a href="#1-1-MySQL主从配置" class="headerlink" title="1.1 MySQL主从配置"></a>1.1 MySQL主从配置</h2><p>启动MySQL主机：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 3307:3306 --name=mysql-master --privileged=true \</span><br><span class="line">-v /mydata/mysql-master/log:/var/log/mysql \</span><br><span class="line">-v /mydata/mysql-master/data:/var/lib/mysql \</span><br><span class="line">-v /mydata/mysql-master/conf:/etc/mysql \</span><br><span class="line">-v /home/mysql/mysql-files:/var/lib/mysql-files \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=root \</span><br><span class="line">-d mysql</span><br></pre></td></tr></table></figure>

<p>进入配置文件夹(&#x2F;mydata&#x2F;mysql-master&#x2F;conf)，添加配置文件my.cnf：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">## 设置server_id，同一局域网中需要唯一</span><br><span class="line">server_id=101</span><br><span class="line">## 指定不需要同步的数据库名称</span><br><span class="line">binlog-ignore-db=mysql</span><br><span class="line">## 开启二进制日志功能</span><br><span class="line">log-bin=mall-mysql-bin</span><br><span class="line">## 设置二进制日志使用内存大小(事务)</span><br><span class="line">binlog_cache_size=1M</span><br><span class="line">## 设置使用的二进制日志格式(mixed, statement, row)</span><br><span class="line">binlog_format=mixed</span><br><span class="line">## 二进制日志过期清理时间。默认为0表示不清理</span><br><span class="line">expire_logs_days=7</span><br><span class="line">## 跳过主从复制中遇到的所有的错误或指定类型的错误，避免slave端复制中断。</span><br><span class="line">## 如：1062错误是指一些主键重复，1032是指主从数据库不一致</span><br><span class="line">slave_skip_errors=1062</span><br></pre></td></tr></table></figure>

<p>进入主数据库创建从机账号：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CREATE USER &#x27;slave&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;123456&#x27;;</span><br><span class="line">GRANT REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO &#x27;slave&#x27;@&#x27;%&#x27;;</span><br></pre></td></tr></table></figure>

<p>启动从数据库：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 3308:3306 --name=mysql-slave --privileged=true \</span><br><span class="line">-v /mydata/mysql-slave/log:/var/log/mysql \</span><br><span class="line">-v /mydata/mysql-slave/data:/var/lib/mysql \</span><br><span class="line">-v /mydata/mysql-slave/conf:/etc/mysql \</span><br><span class="line">-v /home/mysql-slave/mysql-files:/var/lib/mysql-files \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=root \</span><br><span class="line">-d mysql</span><br></pre></td></tr></table></figure>

<p>添加配置文件(my.cnf)：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">## 设置server_id，同一局域网中需要唯一</span><br><span class="line">server_id=102</span><br><span class="line">## 指定不需要同步的数据库名称</span><br><span class="line">binlog-ignore-db=mysql</span><br><span class="line">## 开启二进制日志功能</span><br><span class="line">log-bin=mall-mysql-slave1-bin</span><br><span class="line">## 设置二进制日志使用内存大小(事务)</span><br><span class="line">binlog_cache_size=1M</span><br><span class="line">## 设置使用的二进制日志格式(mixed, statement, row)</span><br><span class="line">binlog_format=mixed</span><br><span class="line">## 二进制日志过期清理时间。默认为0表示不清理</span><br><span class="line">expire_logs_days=7</span><br><span class="line">## 跳过主从复制中遇到的所有的错误或指定类型的错误，避免slave端复制中断。</span><br><span class="line">## 如：1062错误是指一些主键重复，1032是指主从数据库不一致</span><br><span class="line">slave_skip_errors=1062</span><br><span class="line">## log_slave_updates表示slave将复制事件写进自己的二进制日志</span><br><span class="line">log_slave_updates=1</span><br><span class="line">## slave设置为只读</span><br><span class="line">read_only=1</span><br><span class="line">## relay_log配置中继日志</span><br><span class="line">relay_log=mall-mysql-relay-bin</span><br></pre></td></tr></table></figure>

<p>在主数据库中查看主从同步状态：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">mysql&amp;gt; </span><span class="language-bash">show master status;</span></span><br><span class="line">+-----------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| File                  | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |</span><br><span class="line">+-----------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| mall-mysql-bin.000005 |      712 |              | mysql            |                   |</span><br><span class="line">+-----------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>在从数据库中配置主从复制：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">change master to master_host=&quot;宿主机ip&quot;, master_user=&#x27;slave&#x27;, master_password=&#x27;123456&#x27;, master_port=3307, master_log_file=&#x27;mall-mysql-bin.000005&#x27;, master_log_pos=712, master_connect_retry=30</span><br></pre></td></tr></table></figure>

<p>在从数据库中查看主从复制状态：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">mysql&amp;gt; </span><span class="language-bash">show slave status \G;</span></span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: </span><br><span class="line">                  Master_Host: 192.168.170.131</span><br><span class="line">                  Master_User: slave</span><br><span class="line">                  Master_Port: 3307</span><br><span class="line">                Connect_Retry: 30</span><br><span class="line">              Master_Log_File: mall-mysql-bin.000005</span><br><span class="line">          Read_Master_Log_Pos: 712</span><br><span class="line">               Relay_Log_File: mall-mysql-relay-bin.000001</span><br><span class="line">                Relay_Log_Pos: 4</span><br><span class="line">        Relay_Master_Log_File: mall-mysql-bin.000005</span><br><span class="line">             Slave_IO_Running: No</span><br><span class="line">            Slave_SQL_Running: No</span><br><span class="line">            </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">1 row in set, 1 warning (0.01 sec)</span><br></pre></td></tr></table></figure>

<p>在从数据库中开启主从同步：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">start slave;</span><br></pre></td></tr></table></figure>

<h1 id="2-Redis分布式部署"><a href="#2-Redis分布式部署" class="headerlink" title="2. Redis分布式部署"></a>2. Redis分布式部署</h1><p>Redis分布式哈希主要使用哈希槽实现。这里将以3主3从的方式演示。</p>
<p>启动6个redis：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name redis-node-1 --net host --privileged=true -v /data/redis/share/redis-node-1:/data redis --cluster-enabled yes --appendonly yes --port 6381</span><br><span class="line"></span><br><span class="line">docker run -d --name redis-node-2 --net host --privileged=true -v /data/redis/share/redis-node-2:/data redis --cluster-enabled yes --appendonly yes --port 6382</span><br><span class="line"></span><br><span class="line">docker run -d --name redis-node-3 --net host --privileged=true -v /data/redis/share/redis-node-3:/data redis --cluster-enabled yes --appendonly yes --port 6383</span><br><span class="line"></span><br><span class="line">docker run -d --name redis-node-4 --net host --privileged=true -v /data/redis/share/redis-node-4:/data redis --cluster-enabled yes --appendonly yes --port 6384</span><br><span class="line"></span><br><span class="line">docker run -d --name redis-node-5 --net host --privileged=true -v /data/redis/share/redis-node-5:/data redis --cluster-enabled yes --appendonly yes --port 6385</span><br><span class="line"></span><br><span class="line">docker run -d --name redis-node-6 --net host --privileged=true -v /data/redis/share/redis-node-6:/data redis --cluster-enabled yes --appendonly yes --port 6386</span><br></pre></td></tr></table></figure>

<p>进入redis容器后，输入如下指令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli --cluster create 192.168.170.131:6381 192.168.170.131:6382 192.168.170.131:6383 192.168.170.131:6384 192.168.170.131:6385 192.168.170.131:6386 --cluster-replicas 1</span><br></pre></td></tr></table></figure>

<p>这里的IP需要修改为自己的，<code>--cluster-replicas</code>表示为每一个master创建一个<code>slave</code>节点。</p>
<p>运行结果：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker exec -it redis-node-1 /bin/bash</span><br><span class="line">root@localhost:/data# redis-cli --cluster create 192.168.170.131:6381 192.168.170.131:6382 192.168.170.131:6383 192.168.170.131:6384 192.168.170.131:6385 192.168.170.131:6386 --cluster-replicas 1</span><br><span class="line"><span class="meta prompt_">&amp;gt;</span><span class="language-bash">&amp;gt;&amp;gt; Performing <span class="built_in">hash</span> slots allocation on 6 nodes...</span></span><br><span class="line">Master[0] -&amp;gt; Slots 0 - 5460</span><br><span class="line">Master[1] -&amp;gt; Slots 5461 - 10922</span><br><span class="line">Master[2] -&amp;gt; Slots 10923 - 16383</span><br><span class="line">Adding replica 192.168.170.131:6385 to 192.168.170.131:6381</span><br><span class="line">Adding replica 192.168.170.131:6386 to 192.168.170.131:6382</span><br><span class="line">Adding replica 192.168.170.131:6384 to 192.168.170.131:6383</span><br><span class="line"><span class="meta prompt_">&amp;gt;</span><span class="language-bash">&amp;gt;&amp;gt; Trying to optimize slaves allocation <span class="keyword">for</span> anti-affinity</span></span><br><span class="line">[WARNING] Some slaves are in the same host as their master</span><br><span class="line">M: f68a76ffd6a7d405ee7d9645c28964ec3f6d56f5 192.168.170.131:6381</span><br><span class="line">   slots:[0-5460] (5461 slots) master</span><br><span class="line">M: 3966aca2c22809e62891386d1fe815edb8a13c4d 192.168.170.131:6382</span><br><span class="line">   slots:[5461-10922] (5462 slots) master</span><br><span class="line">M: 8513fb8649e422c0082baf1c53a3fc618eff2ced 192.168.170.131:6383</span><br><span class="line">   slots:[10923-16383] (5461 slots) master</span><br><span class="line">S: 9dcca86c999abdad29214c1167c6a41d6861d78d 192.168.170.131:6384</span><br><span class="line">   replicates 3966aca2c22809e62891386d1fe815edb8a13c4d</span><br><span class="line">S: af329601a2212a38377611fa808844a12089fad6 192.168.170.131:6385</span><br><span class="line">   replicates 8513fb8649e422c0082baf1c53a3fc618eff2ced</span><br><span class="line">S: 4552034720a87b8fa6d2b5411f2d275c260113d0 192.168.170.131:6386</span><br><span class="line">   replicates f68a76ffd6a7d405ee7d9645c28964ec3f6d56f5</span><br><span class="line">Can I set the above configuration? (type &#x27;yes&#x27; to accept): yes</span><br><span class="line"><span class="meta prompt_">&amp;gt;</span><span class="language-bash">&amp;gt;&amp;gt; Nodes configuration updated</span></span><br><span class="line"><span class="meta prompt_">&amp;gt;</span><span class="language-bash">&amp;gt;&amp;gt; Assign a different config epoch to each node</span></span><br><span class="line"><span class="meta prompt_">&amp;gt;</span><span class="language-bash">&amp;gt;&amp;gt; Sending CLUSTER MEET messages to <span class="built_in">join</span> the cluster</span></span><br><span class="line">Waiting for the cluster to join</span><br><span class="line">.</span><br><span class="line"><span class="meta prompt_">&amp;gt;</span><span class="language-bash">&amp;gt;&amp;gt; Performing Cluster Check (using node 192.168.170.131:6381)</span></span><br><span class="line">M: f68a76ffd6a7d405ee7d9645c28964ec3f6d56f5 192.168.170.131:6381</span><br><span class="line">   slots:[0-5460] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">M: 3966aca2c22809e62891386d1fe815edb8a13c4d 192.168.170.131:6382</span><br><span class="line">   slots:[5461-10922] (5462 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 9dcca86c999abdad29214c1167c6a41d6861d78d 192.168.170.131:6384</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 3966aca2c22809e62891386d1fe815edb8a13c4d</span><br><span class="line">S: af329601a2212a38377611fa808844a12089fad6 192.168.170.131:6385</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 8513fb8649e422c0082baf1c53a3fc618eff2ced</span><br><span class="line">M: 8513fb8649e422c0082baf1c53a3fc618eff2ced 192.168.170.131:6383</span><br><span class="line">   slots:[10923-16383] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 4552034720a87b8fa6d2b5411f2d275c260113d0 192.168.170.131:6386</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates f68a76ffd6a7d405ee7d9645c28964ec3f6d56f5</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line"><span class="meta prompt_">&amp;gt;</span><span class="language-bash">&amp;gt;&amp;gt; Check <span class="keyword">for</span> open slots...</span></span><br><span class="line"><span class="meta prompt_">&amp;gt;</span><span class="language-bash">&amp;gt;&amp;gt; Check slots coverage...</span></span><br><span class="line">[OK] All 16384 slots covered.</span><br></pre></td></tr></table></figure>

<p>查看集群状态：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># redis-cli</span></span></span><br><span class="line">cluster info</span><br><span class="line">cluster nodes</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># shell</span></span></span><br><span class="line">redis-cli --cluster check [host]:[port]</span><br></pre></td></tr></table></figure>

<p>主从机的指定是随机的，每次都可能不同。</p>
<p>在连接redis时需要添加<code>-c</code>参数，以集群的方式连接：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -p 6381 -c</span><br></pre></td></tr></table></figure>

<p>进入1号节点，若不使用<code>-c</code>参数：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6381&amp;gt; set k1 v1</span><br><span class="line">(error) MOVED 12706 192.168.170.131:6383</span><br></pre></td></tr></table></figure>

<p>使用<code>-c</code>参数：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6381&amp;gt; set k1 v1</span><br><span class="line"><span class="meta prompt_">-&amp;gt; </span><span class="language-bash">Redirected to slot [12706] located at 192.168.170.131:6383</span></span><br><span class="line">OK</span><br></pre></td></tr></table></figure>

<h2 id="2-1-Redis主从切换"><a href="#2-1-Redis主从切换" class="headerlink" title="2.1 Redis主从切换"></a>2.1 Redis主从切换</h2><p>上面我们部署了3主3从后，此时我们关闭1号节点，期望6号机能够”上位”。</p>
<p>关闭1号节点：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop redis-node-1</span><br></pre></td></tr></table></figure>

<p>进入任意节点，查看节点状态：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6382&amp;gt; cluster nodes</span><br><span class="line">8513fb8649e422c0082baf1c53a3fc618eff2ced 192.168.170.131:6383@16383 master - 0 1682330542000 3 connected 10923-16383</span><br><span class="line">9dcca86c999abdad29214c1167c6a41d6861d78d 192.168.170.131:6384@16384 slave 3966aca2c22809e62891386d1fe815edb8a13c4d 0 1682330541000 2 connected</span><br><span class="line">4552034720a87b8fa6d2b5411f2d275c260113d0 192.168.170.131:6386@16386 master - 0 1682330542667 7 connected 0-5460</span><br><span class="line">af329601a2212a38377611fa808844a12089fad6 192.168.170.131:6385@16385 slave 8513fb8649e422c0082baf1c53a3fc618eff2ced 0 1682330541663 3 connected</span><br><span class="line">f68a76ffd6a7d405ee7d9645c28964ec3f6d56f5 192.168.170.131:6381@16381 master,fail - 1682330496440 1682330493000 1 disconnected</span><br><span class="line">3966aca2c22809e62891386d1fe815edb8a13c4d 192.168.170.131:6382@16382 myself,master - 0 1682330541000 2 connected 5461-10922</span><br></pre></td></tr></table></figure>

<p>可以发现6号节点已经成为master节点。在1号节点重启后，1号节点会变为slave状态，6号节点会仍然是master。</p>
<h2 id="2-2-Redis主从扩容"><a href="#2-2-Redis主从扩容" class="headerlink" title="2.2 Redis主从扩容"></a>2.2 Redis主从扩容</h2><p>新增两个容器：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name redis-node-7 --net host --privileged=true -v /data/redis/share/redis-node-7:/data redis --cluster-enabled yes --appendonly yes --port 6387</span><br><span class="line"></span><br><span class="line">docker run -d --name redis-node-8 --net host --privileged=true -v /data/redis/share/redis-node-8:/data redis --cluster-enabled yes --appendonly yes --port 6388</span><br></pre></td></tr></table></figure>

<p>将新增的6387作为master节点加入集群：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli --cluster add-node [自己的IP]:6387 [某一集群Reids的IP]:[PORT]</span><br></pre></td></tr></table></figure>

<p>在新增的节点默认不会被分配槽位：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@localhost:/data# redis-cli --cluster check 192.168.170.131:6387</span><br><span class="line">192.168.170.131:6387 (693799ad...) -&amp;gt; 0 keys | 0 slots | 0 slaves.</span><br><span class="line">192.168.170.131:6382 (3966aca2...) -&amp;gt; 0 keys | 5462 slots | 1 slaves.</span><br><span class="line">192.168.170.131:6383 (8513fb86...) -&amp;gt; 1 keys | 5461 slots | 1 slaves.</span><br><span class="line">192.168.170.131:6386 (45520347...) -&amp;gt; 2 keys | 5461 slots | 1 slaves.</span><br></pre></td></tr></table></figure>

<p>使用如下指令重新分配槽号：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli --cluster reshard [IP]:[PORT]</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">root@localhost:/data# redis-cli --cluster reshard 192.168.170.131:6387</span><br><span class="line"><span class="meta prompt_">&amp;gt;</span><span class="language-bash">&amp;gt;&amp;gt; Performing Cluster Check (using node 192.168.170.131:6387)</span></span><br><span class="line">M: 693799adb79799c38a343feb09a6df95f60a0fb4 192.168.170.131:6387</span><br><span class="line">   slots: (0 slots) master</span><br><span class="line">S: 9dcca86c999abdad29214c1167c6a41d6861d78d 192.168.170.131:6384</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 3966aca2c22809e62891386d1fe815edb8a13c4d</span><br><span class="line">M: 3966aca2c22809e62891386d1fe815edb8a13c4d 192.168.170.131:6382</span><br><span class="line">   slots:[5461-10922] (5462 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">M: 8513fb8649e422c0082baf1c53a3fc618eff2ced 192.168.170.131:6383</span><br><span class="line">   slots:[10923-16383] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">M: 4552034720a87b8fa6d2b5411f2d275c260113d0 192.168.170.131:6386</span><br><span class="line">   slots:[0-5460] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: f68a76ffd6a7d405ee7d9645c28964ec3f6d56f5 192.168.170.131:6381</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 4552034720a87b8fa6d2b5411f2d275c260113d0</span><br><span class="line">S: af329601a2212a38377611fa808844a12089fad6 192.168.170.131:6385</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 8513fb8649e422c0082baf1c53a3fc618eff2ced</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line"><span class="meta prompt_">&amp;gt;</span><span class="language-bash">&amp;gt;&amp;gt; Check <span class="keyword">for</span> open slots...</span></span><br><span class="line"><span class="meta prompt_">&amp;gt;</span><span class="language-bash">&amp;gt;&amp;gt; Check slots coverage...</span></span><br><span class="line">[OK] All 16384 slots covered.</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">这里由于是4台机器，需要给平分出来就是4096，意思是给新机器分4096个槽出去</span></span><br><span class="line">How many slots do you want to move (from 1 to 16384)? 4096</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">要分配的节点ID</span></span><br><span class="line">What is the receiving node ID? 693799adb79799c38a343feb09a6df95f60a0fb4</span><br><span class="line">Please enter all the source node IDs.</span><br><span class="line">  Type &#x27;all&#x27; to use all the nodes as source nodes for the hash slots.</span><br><span class="line">  Type &#x27;done&#x27; once you entered all the source nodes IDs.</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">这里表示谁来出这些槽位，使用all表示从所有主节点中拿出槽位</span></span><br><span class="line">Source node #1: all</span><br></pre></td></tr></table></figure>

<p>再次检查集群状态：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">root@localhost:/data# redis-cli --cluster check 192.168.170.131:6387</span><br><span class="line">192.168.170.131:6387 (693799ad...) -&amp;gt; 1 keys | 4096 slots | 0 slaves.</span><br><span class="line">192.168.170.131:6382 (3966aca2...) -&amp;gt; 0 keys | 4096 slots | 1 slaves.</span><br><span class="line">192.168.170.131:6383 (8513fb86...) -&amp;gt; 1 keys | 4096 slots | 1 slaves.</span><br><span class="line">192.168.170.131:6386 (45520347...) -&amp;gt; 1 keys | 4096 slots | 1 slaves.</span><br><span class="line">[OK] 3 keys in 4 masters.</span><br><span class="line">0.00 keys per slot on average.</span><br><span class="line"><span class="meta prompt_">&amp;gt;</span><span class="language-bash">&amp;gt;&amp;gt; Performing Cluster Check (using node 192.168.170.131:6387)</span></span><br><span class="line">M: 693799adb79799c38a343feb09a6df95f60a0fb4 192.168.170.131:6387</span><br><span class="line">   slots:[0-1364],[5461-6826],[10923-12287] (4096 slots) master</span><br><span class="line">S: 9dcca86c999abdad29214c1167c6a41d6861d78d 192.168.170.131:6384</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 3966aca2c22809e62891386d1fe815edb8a13c4d</span><br><span class="line">M: 3966aca2c22809e62891386d1fe815edb8a13c4d 192.168.170.131:6382</span><br><span class="line">   slots:[6827-10922] (4096 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">M: 8513fb8649e422c0082baf1c53a3fc618eff2ced 192.168.170.131:6383</span><br><span class="line">   slots:[12288-16383] (4096 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">M: 4552034720a87b8fa6d2b5411f2d275c260113d0 192.168.170.131:6386</span><br><span class="line">   slots:[1365-5460] (4096 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: f68a76ffd6a7d405ee7d9645c28964ec3f6d56f5 192.168.170.131:6381</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 4552034720a87b8fa6d2b5411f2d275c260113d0</span><br><span class="line">S: af329601a2212a38377611fa808844a12089fad6 192.168.170.131:6385</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 8513fb8649e422c0082baf1c53a3fc618eff2ced</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line"><span class="meta prompt_">&amp;gt;</span><span class="language-bash">&amp;gt;&amp;gt; Check <span class="keyword">for</span> open slots...</span></span><br><span class="line"><span class="meta prompt_">&amp;gt;</span><span class="language-bash">&amp;gt;&amp;gt; Check slots coverage...</span></span><br><span class="line">[OK] All 16384 slots covered.</span><br></pre></td></tr></table></figure>

<p><font color=red>可以发现扩容时，已有节点的右区间不变，每次都是在左区间”平分”给新的节点，新节点的哈希槽并不是连续的</font>。</p>
<p>最后再将最后一个从节点加入集群：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli --cluster add-node [从机Host]:[从机PORT] [主机Host]:[主机PORT] --cluster-slave --cluster-master-id [主节点ID]</span><br></pre></td></tr></table></figure>

<h2 id="2-3-Redis主从缩容"><a href="#2-3-Redis主从缩容" class="headerlink" title="2.3 Redis主从缩容"></a>2.3 Redis主从缩容</h2><p>Redis集群缩容，在这里删除6387和6388节点。</p>
<p>首先需要删除从节点：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli --cluster del-node [从机HOST]:[从机IP] [从机节点ID]</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@localhost:/data# redis-cli --cluster del-node 192.168.170.131:6388 21b32459b66ff851ee5eaa540749589484172909</span><br><span class="line"><span class="meta prompt_">&amp;gt;</span><span class="language-bash">&amp;gt;&amp;gt; Removing node 21b32459b66ff851ee5eaa540749589484172909 from cluster 192.168.170.131:6388</span></span><br><span class="line"><span class="meta prompt_">&amp;gt;</span><span class="language-bash">&amp;gt;&amp;gt; Sending CLUSTER FORGET messages to the cluster...</span></span><br><span class="line"><span class="meta prompt_">&amp;gt;</span><span class="language-bash">&amp;gt;&amp;gt; Sending CLUSTER RESET SOFT to the deleted node.</span></span><br></pre></td></tr></table></figure>

<p>之后删除主节点，并将它的槽位全部分配给另外一个主节点：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli --cluster reshard [要分配给的节点Host]:[节点PORT]</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">root@localhost:/data# redis-cli --cluster del-node 192.168.170.131:6388 21b32459b66ff851ee5eaa540749589484172909</span><br><span class="line"><span class="meta prompt_">&amp;gt;</span><span class="language-bash">&amp;gt;&amp;gt; Removing node 21b32459b66ff851ee5eaa540749589484172909 from cluster 192.168.170.131:6388</span></span><br><span class="line"><span class="meta prompt_">&amp;gt;</span><span class="language-bash">&amp;gt;&amp;gt; Sending CLUSTER FORGET messages to the cluster...</span></span><br><span class="line"><span class="meta prompt_">&amp;gt;</span><span class="language-bash">&amp;gt;&amp;gt; Sending CLUSTER RESET SOFT to the deleted node.</span></span><br><span class="line">root@localhost:/data# redis-cli --cluster reshard 192.168.170.131:6381</span><br><span class="line"><span class="meta prompt_">&amp;gt;</span><span class="language-bash">&amp;gt;&amp;gt; Performing Cluster Check (using node 192.168.170.131:6381)</span></span><br><span class="line">S: f68a76ffd6a7d405ee7d9645c28964ec3f6d56f5 192.168.170.131:6381</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 4552034720a87b8fa6d2b5411f2d275c260113d0</span><br><span class="line">M: 3966aca2c22809e62891386d1fe815edb8a13c4d 192.168.170.131:6382</span><br><span class="line">   slots:[6827-10922] (4096 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">M: 4552034720a87b8fa6d2b5411f2d275c260113d0 192.168.170.131:6386</span><br><span class="line">   slots:[1365-5460] (4096 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: af329601a2212a38377611fa808844a12089fad6 192.168.170.131:6385</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 8513fb8649e422c0082baf1c53a3fc618eff2ced</span><br><span class="line">M: 8513fb8649e422c0082baf1c53a3fc618eff2ced 192.168.170.131:6383</span><br><span class="line">   slots:[12288-16383] (4096 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">M: 693799adb79799c38a343feb09a6df95f60a0fb4 192.168.170.131:6387</span><br><span class="line">   slots:[0-1364],[5461-6826],[10923-12287] (4096 slots) master</span><br><span class="line">S: 9dcca86c999abdad29214c1167c6a41d6861d78d 192.168.170.131:6384</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 3966aca2c22809e62891386d1fe815edb8a13c4d</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line"><span class="meta prompt_">&amp;gt;</span><span class="language-bash">&amp;gt;&amp;gt; Check <span class="keyword">for</span> open slots...</span></span><br><span class="line"><span class="meta prompt_">&amp;gt;</span><span class="language-bash">&amp;gt;&amp;gt; Check slots coverage...</span></span><br><span class="line">[OK] All 16384 slots covered.</span><br><span class="line">How many slots do you want to move (from 1 to 16384)? 4096</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">谁接收</span></span><br><span class="line">What is the receiving node ID? 4552034720a87b8fa6d2b5411f2d275c260113d0</span><br><span class="line">Please enter all the source node IDs.</span><br><span class="line">  Type &#x27;all&#x27; to use all the nodes as source nodes for the hash slots.</span><br><span class="line">  Type &#x27;done&#x27; once you entered all the source nodes IDs.</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">节点6387<span class="string">&quot;出血&quot;</span></span></span><br><span class="line">Source node #1: 693799adb79799c38a343feb09a6df95f60a0fb4</span><br><span class="line">Source node #2: done</span><br></pre></td></tr></table></figure>

<p>检查集群状态：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@localhost:/data# redis-cli --cluster check 192.168.170.131:6381</span><br><span class="line">192.168.170.131:6382 (3966aca2...) -&amp;gt; 0 keys | 4096 slots | 1 slaves.</span><br><span class="line">192.168.170.131:6386 (45520347...) -&amp;gt; 2 keys | 8192 slots | 1 slaves.</span><br><span class="line">192.168.170.131:6383 (8513fb86...) -&amp;gt; 1 keys | 4096 slots | 1 slaves.</span><br><span class="line">192.168.170.131:6387 (693799ad...) -&amp;gt; 0 keys | 0 slots | 0 slaves.</span><br></pre></td></tr></table></figure>

<p>最后可以直接将6387删除：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli --cluster del-node [IP]:[PORT] [节点ID]</span><br></pre></td></tr></table></figure>


    </div>
    
    
    
    
    <div id="comment">
        <div id="giscus-container" class="giscus"></div>
    </div>
    
    
    
    
</div>

                <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2022 - 2024 IceOfSummerの博客
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;IceOfSummer
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/argvchs/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

            </div>
            </transition>
            
            <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
            </transition>
            
        </div>
        <script src="/js/main.js"></script>
        
        
<script
    src="https://giscus.app/client.js"
    data-repo="IceOfSummer/iceofsummer.github.io"
    data-repo-id="R_kgDOJFU7OQ"
    data-category="Announcements"
    data-category-id="DIC_kwDOJFU7Oc4CUyC7"
    data-mapping="title"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="top"
    data-theme="preferred_color_scheme"
    data-lang="zh-CN"
    crossorigin
    async
></script>





        
    </body>
</html>
